<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="es">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>/*******************************************************************************<a name="line.1"></a>
<span class="sourceLineNo">002</span> * Copyright (c) 2016 Pablo Pavon Mari√±o.<a name="line.2"></a>
<span class="sourceLineNo">003</span> * All rights reserved. This program and the accompanying materials<a name="line.3"></a>
<span class="sourceLineNo">004</span> * are made available under the terms of the GNU Lesser Public License v2.1<a name="line.4"></a>
<span class="sourceLineNo">005</span> * which accompanies this distribution, and is available at<a name="line.5"></a>
<span class="sourceLineNo">006</span> * http://www.gnu.org/licenses/lgpl.html<a name="line.6"></a>
<span class="sourceLineNo">007</span> ******************************************************************************/<a name="line.7"></a>
<span class="sourceLineNo">008</span><a name="line.8"></a>
<span class="sourceLineNo">009</span><a name="line.9"></a>
<span class="sourceLineNo">010</span><a name="line.10"></a>
<span class="sourceLineNo">011</span><a name="line.11"></a>
<span class="sourceLineNo">012</span> <a name="line.12"></a>
<span class="sourceLineNo">013</span><a name="line.13"></a>
<span class="sourceLineNo">014</span><a name="line.14"></a>
<span class="sourceLineNo">015</span><a name="line.15"></a>
<span class="sourceLineNo">016</span><a name="line.16"></a>
<span class="sourceLineNo">017</span><a name="line.17"></a>
<span class="sourceLineNo">018</span>package com.net2plan.examples.general.reports;<a name="line.18"></a>
<span class="sourceLineNo">019</span><a name="line.19"></a>
<span class="sourceLineNo">020</span>import java.text.DecimalFormat;<a name="line.20"></a>
<span class="sourceLineNo">021</span>import java.util.ArrayList;<a name="line.21"></a>
<span class="sourceLineNo">022</span>import java.util.LinkedHashMap;<a name="line.22"></a>
<span class="sourceLineNo">023</span>import java.util.LinkedList;<a name="line.23"></a>
<span class="sourceLineNo">024</span>import java.util.List;<a name="line.24"></a>
<span class="sourceLineNo">025</span>import java.util.Map;<a name="line.25"></a>
<span class="sourceLineNo">026</span><a name="line.26"></a>
<span class="sourceLineNo">027</span>import com.net2plan.interfaces.networkDesign.Demand;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import com.net2plan.interfaces.networkDesign.IReport;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import com.net2plan.interfaces.networkDesign.Link;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import com.net2plan.interfaces.networkDesign.NetPlan;<a name="line.30"></a>
<span class="sourceLineNo">031</span>import com.net2plan.interfaces.networkDesign.NetworkLayer;<a name="line.31"></a>
<span class="sourceLineNo">032</span>import com.net2plan.interfaces.networkDesign.Node;<a name="line.32"></a>
<span class="sourceLineNo">033</span>import com.net2plan.interfaces.networkDesign.ProtectionSegment;<a name="line.33"></a>
<span class="sourceLineNo">034</span>import com.net2plan.interfaces.networkDesign.Route;<a name="line.34"></a>
<span class="sourceLineNo">035</span>import com.net2plan.libraries.GraphUtils;<a name="line.35"></a>
<span class="sourceLineNo">036</span>import com.net2plan.libraries.TrafficComputationEngine;<a name="line.36"></a>
<span class="sourceLineNo">037</span>import com.net2plan.libraries.WDMUtils;<a name="line.37"></a>
<span class="sourceLineNo">038</span>import com.net2plan.utils.InputParameter;<a name="line.38"></a>
<span class="sourceLineNo">039</span>import com.net2plan.utils.Pair;<a name="line.39"></a>
<span class="sourceLineNo">040</span>import com.net2plan.utils.Triple;<a name="line.40"></a>
<span class="sourceLineNo">041</span><a name="line.41"></a>
<span class="sourceLineNo">042</span>/**<a name="line.42"></a>
<span class="sourceLineNo">043</span> *<a name="line.43"></a>
<span class="sourceLineNo">044</span> * &lt;p&gt;This report collects information about the Routing and Spectrum assignment in the network, as well as other general information about the WDM layer.&lt;/p&gt;<a name="line.44"></a>
<span class="sourceLineNo">045</span> * &lt;p&gt;This report is valid for the WDM layers compatible with the {@link com.net2plan.libraries.WDMUtils WDMUtils} library .This includes both fixed and flexi-grid networks, <a name="line.45"></a>
<span class="sourceLineNo">046</span> *  with unique or mixed line rates in the lightpaths, with or without optical signal regenerators and wavelength (frequency slot) conversions.&lt;/p&gt;<a name="line.46"></a>
<span class="sourceLineNo">047</span> * &lt;p&gt;The report first checks that the WDM network follows the conventions described in {@link com.net2plan.libraries.WDMUtils WDMUtils} library (see its Javadoc for further information on this).&lt;/p&gt;<a name="line.47"></a>
<span class="sourceLineNo">048</span> * &lt;p&gt;Then, the report provides a number of statistics regarding frequency slot occupation, optical signal <a name="line.48"></a>
<span class="sourceLineNo">049</span> *  regenerators, wavelength (frequency slot) converters needed, etc. It also warns about possible frequency slot clashing <a name="line.49"></a>
<span class="sourceLineNo">050</span> *  two lightpaths using the same slot in the same fibers)&lt;/p&gt;<a name="line.50"></a>
<span class="sourceLineNo">051</span> *  &lt;p&gt;Lightpaths are separated into:&lt;/p&gt;<a name="line.51"></a>
<span class="sourceLineNo">052</span> *  &lt;ul&gt;<a name="line.52"></a>
<span class="sourceLineNo">053</span> *  &lt;li&gt;Regular lightpaths: Those stored as {@code Route} objects in the design.&lt;/li&gt;<a name="line.53"></a>
<span class="sourceLineNo">054</span> *  &lt;li&gt;Protection lightpaths: Those stored as {@code ProtectionSegment} objects in the design.&lt;/li&gt;<a name="line.54"></a>
<span class="sourceLineNo">055</span> *  &lt;/ul&gt;<a name="line.55"></a>
<span class="sourceLineNo">056</span> * @net2plan.keywords WDM<a name="line.56"></a>
<span class="sourceLineNo">057</span> * @author Pablo Pavon-Marino<a name="line.57"></a>
<span class="sourceLineNo">058</span> */ <a name="line.58"></a>
<span class="sourceLineNo">059</span>public class Report_wdm_routingSpectrumAndModulationAssignments implements IReport<a name="line.59"></a>
<span class="sourceLineNo">060</span>{<a name="line.60"></a>
<span class="sourceLineNo">061</span>        /* Input parameters */<a name="line.61"></a>
<span class="sourceLineNo">062</span>        private NetPlan netPlan;<a name="line.62"></a>
<span class="sourceLineNo">063</span>        private NetworkLayer originalDefaultLayer;<a name="line.63"></a>
<span class="sourceLineNo">064</span>        private Map&lt;String, String&gt; reportParameters;<a name="line.64"></a>
<span class="sourceLineNo">065</span>        private Statistics stat;<a name="line.65"></a>
<span class="sourceLineNo">066</span>        private InputParameter wdmLayerIndex = new InputParameter ("wdmLayerIndex", (int) 0 , "Index of the WDM layer (-1 means default layer)");<a name="line.66"></a>
<span class="sourceLineNo">067</span><a name="line.67"></a>
<span class="sourceLineNo">068</span>        @Override<a name="line.68"></a>
<span class="sourceLineNo">069</span>        public String executeReport(NetPlan netPlan, Map&lt;String, String&gt; reportParameters, Map&lt;String, String&gt; net2planParameters)<a name="line.69"></a>
<span class="sourceLineNo">070</span>        {<a name="line.70"></a>
<span class="sourceLineNo">071</span>                /* Initialize all InputParameter objects defined in this object (this uses Java reflection) */<a name="line.71"></a>
<span class="sourceLineNo">072</span>                InputParameter.initializeAllInputParameterFieldsOfObject(this, reportParameters);<a name="line.72"></a>
<span class="sourceLineNo">073</span><a name="line.73"></a>
<span class="sourceLineNo">074</span>                /* Input parameters */<a name="line.74"></a>
<span class="sourceLineNo">075</span>                this.netPlan = netPlan;<a name="line.75"></a>
<span class="sourceLineNo">076</span>                this.reportParameters = reportParameters;<a name="line.76"></a>
<span class="sourceLineNo">077</span>                this.originalDefaultLayer = netPlan.getNetworkLayerDefault();<a name="line.77"></a>
<span class="sourceLineNo">078</span>                final NetworkLayer wdmLayer = wdmLayerIndex.getInt () == -1? netPlan.getNetworkLayerDefault() : netPlan.getNetworkLayer(wdmLayerIndex.getInt ());<a name="line.78"></a>
<span class="sourceLineNo">079</span>                this.netPlan.setNetworkLayerDefault(wdmLayer);<a name="line.79"></a>
<span class="sourceLineNo">080</span><a name="line.80"></a>
<span class="sourceLineNo">081</span>                Map&lt;Link, LinkedList&lt;String&gt;&gt; warnings_e = new LinkedHashMap&lt;Link, LinkedList&lt;String&gt;&gt;();<a name="line.81"></a>
<span class="sourceLineNo">082</span><a name="line.82"></a>
<span class="sourceLineNo">083</span>                String res = printReport();<a name="line.83"></a>
<span class="sourceLineNo">084</span>                netPlan.setNetworkLayerDefault(originalDefaultLayer);<a name="line.84"></a>
<span class="sourceLineNo">085</span>                return res;<a name="line.85"></a>
<span class="sourceLineNo">086</span>        }<a name="line.86"></a>
<span class="sourceLineNo">087</span><a name="line.87"></a>
<span class="sourceLineNo">088</span>        @Override<a name="line.88"></a>
<span class="sourceLineNo">089</span>        public String getDescription()<a name="line.89"></a>
<span class="sourceLineNo">090</span>        {<a name="line.90"></a>
<span class="sourceLineNo">091</span>                return "This report shows line engineering information for WDM links in the network. Further description in the HTML generated.";<a name="line.91"></a>
<span class="sourceLineNo">092</span>        }<a name="line.92"></a>
<span class="sourceLineNo">093</span><a name="line.93"></a>
<span class="sourceLineNo">094</span>        @Override<a name="line.94"></a>
<span class="sourceLineNo">095</span>        public List&lt;Triple&lt;String, String, String&gt;&gt; getParameters()<a name="line.95"></a>
<span class="sourceLineNo">096</span>        {<a name="line.96"></a>
<span class="sourceLineNo">097</span>                /* Returns the parameter information for all the InputParameter objects defined in this object (uses Java reflection) */<a name="line.97"></a>
<span class="sourceLineNo">098</span>                return InputParameter.getInformationAllInputParameterFieldsOfObject(this);<a name="line.98"></a>
<span class="sourceLineNo">099</span>        }<a name="line.99"></a>
<span class="sourceLineNo">100</span><a name="line.100"></a>
<span class="sourceLineNo">101</span>        @Override<a name="line.101"></a>
<span class="sourceLineNo">102</span>        public String getTitle()<a name="line.102"></a>
<span class="sourceLineNo">103</span>        {<a name="line.103"></a>
<span class="sourceLineNo">104</span>                return "WDM line engineering";<a name="line.104"></a>
<span class="sourceLineNo">105</span>        }<a name="line.105"></a>
<span class="sourceLineNo">106</span><a name="line.106"></a>
<span class="sourceLineNo">107</span>        private String printReport()<a name="line.107"></a>
<span class="sourceLineNo">108</span>        {<a name="line.108"></a>
<span class="sourceLineNo">109</span>                StringBuilder out = new StringBuilder();<a name="line.109"></a>
<span class="sourceLineNo">110</span>                DecimalFormat df_2 = new DecimalFormat("###.##");<a name="line.110"></a>
<span class="sourceLineNo">111</span><a name="line.111"></a>
<span class="sourceLineNo">112</span>                out.append("&lt;html&gt;&lt;body&gt;");<a name="line.112"></a>
<span class="sourceLineNo">113</span>                out.append("&lt;head&gt;&lt;title&gt;WDM Lightpath Routing and Spectrum Assignment (fixed or flexi-grid networks) report&lt;/title&gt;&lt;/head&gt;");<a name="line.113"></a>
<span class="sourceLineNo">114</span>                out.append("&lt;h1&gt;WDM Lightpath Routing and Spectrum Assignment report (fixed or flexi-grid networks)&lt;/h1&gt;");<a name="line.114"></a>
<span class="sourceLineNo">115</span>                out.append("&lt;p&gt;This report collects information about the Routing and Spectrum assignment in the network, as well as other general information about the WDM layer.&lt;/p&gt;");<a name="line.115"></a>
<span class="sourceLineNo">116</span>                out.append("&lt;p&gt;This report is valid for the WDM layers compatible with the WDMUtils library .This includes both fixed and flexi-grid networks, "<a name="line.116"></a>
<span class="sourceLineNo">117</span>                                + "with unique or mixed line rates in the lightpaths, with or without optical signal regenerators and wavelength (frequency slot) conversions.&lt;/p&gt;");<a name="line.117"></a>
<span class="sourceLineNo">118</span>                out.append("&lt;p&gt;The report first checks that the WDM network follows the conventions described in WDMUtils library (see its Javadoc for further information on this).&lt;/p&gt;");<a name="line.118"></a>
<span class="sourceLineNo">119</span>                out.append("&lt;p&gt;Then, the report provides a number of statistics regarding frequency slot occupation, optical signal "<a name="line.119"></a>
<span class="sourceLineNo">120</span>                                + "regenerators, wavelength (frequency slot) converters needed, etc. It also warns about possible frequency slot clashing "<a name="line.120"></a>
<span class="sourceLineNo">121</span>                                + "(two lightpaths using the same slot in the same fibers)&lt;/p&gt;");<a name="line.121"></a>
<span class="sourceLineNo">122</span>                out.append("&lt;p&gt;Lightpaths are separated into:&lt;/p&gt;");<a name="line.122"></a>
<span class="sourceLineNo">123</span>                out.append("&lt;ul&gt;");<a name="line.123"></a>
<span class="sourceLineNo">124</span>                out.append("&lt;li&gt;Regular lightpaths: Those stored as Route objects in the design.&lt;/li&gt;");<a name="line.124"></a>
<span class="sourceLineNo">125</span>                out.append("&lt;li&gt;Protection lightpaths: Those stored as ProtectionSegment objects in the design.&lt;/li&gt;");<a name="line.125"></a>
<span class="sourceLineNo">126</span>                out.append("&lt;/ul&gt;");<a name="line.126"></a>
<span class="sourceLineNo">127</span>                out.append("&lt;h2&gt;Click to go to...&lt;/h2&gt;");<a name="line.127"></a>
<span class="sourceLineNo">128</span>                out.append("&lt;ul&gt;");<a name="line.128"></a>
<span class="sourceLineNo">129</span>                out.append("&lt;li&gt;&lt;a href=\"#inputParameters\"&gt;Input parameters&lt;/a&gt;&lt;/li&gt;");<a name="line.129"></a>
<span class="sourceLineNo">130</span>                out.append("&lt;li&gt;&lt;a href=\"#generalStats\"&gt;General statistics&lt;/a&gt;&lt;/li&gt;");<a name="line.130"></a>
<span class="sourceLineNo">131</span>                out.append("&lt;li&gt;&lt;a href=\"#linkStats\"&gt;Per fiber statistics (including slot occupation map)&lt;/a&gt;&lt;/li&gt;");<a name="line.131"></a>
<span class="sourceLineNo">132</span>                out.append("&lt;li&gt;&lt;a href=\"#routeStats\"&gt;Per regular lightpath statistics&lt;/a&gt;&lt;/li&gt;");<a name="line.132"></a>
<span class="sourceLineNo">133</span>                out.append("&lt;li&gt;&lt;a href=\"#protectionStats\"&gt;Per protection lightpath statistics&lt;/a&gt;&lt;/li&gt;");<a name="line.133"></a>
<span class="sourceLineNo">134</span>                out.append("&lt;li&gt;&lt;a href=\"#nodeStats\"&gt;Per OADM statistics&lt;/a&gt;&lt;/li&gt;");<a name="line.134"></a>
<span class="sourceLineNo">135</span>                out.append("&lt;/ul&gt;");<a name="line.135"></a>
<span class="sourceLineNo">136</span><a name="line.136"></a>
<span class="sourceLineNo">137</span>                <a name="line.137"></a>
<span class="sourceLineNo">138</span>                out.append("&lt;h2&gt;&lt;a name=\"inputParameters\"&gt;&lt;/a&gt;Input Parameters&lt;/h2&gt;");<a name="line.138"></a>
<span class="sourceLineNo">139</span>                out.append("&lt;table border='1'&gt;");<a name="line.139"></a>
<span class="sourceLineNo">140</span>                out.append("&lt;tr&gt;&lt;th&gt;&lt;b&gt;Name&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Value&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Description&lt;/b&gt;&lt;/th&gt;");<a name="line.140"></a>
<span class="sourceLineNo">141</span><a name="line.141"></a>
<span class="sourceLineNo">142</span>                for (Triple&lt;String, String, String&gt; paramDef : getParameters())<a name="line.142"></a>
<span class="sourceLineNo">143</span>                {<a name="line.143"></a>
<span class="sourceLineNo">144</span>                        String name = paramDef.getFirst();<a name="line.144"></a>
<span class="sourceLineNo">145</span>                        String description = paramDef.getThird();<a name="line.145"></a>
<span class="sourceLineNo">146</span>                        String value = reportParameters.get(name);<a name="line.146"></a>
<span class="sourceLineNo">147</span>                        out.append("&lt;tr&gt;&lt;td&gt;").append(name).append("&lt;/td&gt;&lt;td&gt;").append(value).append("&lt;/td&gt;&lt;td&gt;").append(description).append("&lt;/td&gt;&lt;/tr&gt;");<a name="line.147"></a>
<span class="sourceLineNo">148</span>                }<a name="line.148"></a>
<span class="sourceLineNo">149</span>                out.append("&lt;/table&gt;");<a name="line.149"></a>
<span class="sourceLineNo">150</span><a name="line.150"></a>
<span class="sourceLineNo">151</span>                /* Check that the topology is well formed */<a name="line.151"></a>
<span class="sourceLineNo">152</span>                out.append("&lt;h2&gt;&lt;a name=\"malformedMessages\"&gt;&lt;/a&gt;MALFORMED WDM LAYER WARNINGS&lt;/h2&gt;");<a name="line.152"></a>
<span class="sourceLineNo">153</span>                out.append("&lt;p&gt;This section gets possible format errors in the WDM layer attributes of links, routes, protection segments, according to the "<a name="line.153"></a>
<span class="sourceLineNo">154</span>                                + "WDMUtils library conventions. Resource allocation clashings are not checked here. Any failure should be solved before this report can show any information&lt;/p&gt;");<a name="line.154"></a>
<span class="sourceLineNo">155</span>                boolean correctFormat = true;<a name="line.155"></a>
<span class="sourceLineNo">156</span>                out.append("&lt;table border='1'&gt;");<a name="line.156"></a>
<span class="sourceLineNo">157</span>                out.append("&lt;tr&gt;&lt;th align=\"left\"&gt;&lt;b&gt;Format errors&lt;/b&gt;&lt;/th&gt;&lt;/tr&gt;");<a name="line.157"></a>
<span class="sourceLineNo">158</span>                for (Link e : netPlan.getLinks()) if (!WDMUtils.isWDMFormatCorrect(e)) { correctFormat = false ; out.append("&lt;tr&gt;&lt;td&gt;Fiber " + e.getIndex() + ": incorrect format&lt;/td&gt;&lt;/tr&gt;"); }<a name="line.158"></a>
<span class="sourceLineNo">159</span>                for (Route r : netPlan.getRoutes()) if (!WDMUtils.isWDMFormatCorrect(r)) { correctFormat = false ; out.append("&lt;tr&gt;&lt;td&gt;Route " + r.getIndex() + ": incorrect format&lt;/td&gt;&lt;/tr&gt;"); }<a name="line.159"></a>
<span class="sourceLineNo">160</span>                for (ProtectionSegment r : netPlan.getProtectionSegments()) if (!WDMUtils.isWDMFormatCorrect(r)) { correctFormat = false ; out.append("&lt;tr&gt;&lt;td&gt;ProtectionSegment " + r.getIndex() + ": incorrect format&lt;/td&gt;&lt;/tr&gt;"); }<a name="line.160"></a>
<span class="sourceLineNo">161</span>                if (correctFormat) out.append("&lt;tr&gt;&lt;td bgcolor=\"PaleGreen\"&gt;No format errors!!!&lt;/td&gt;&lt;/tr&gt;"); <a name="line.161"></a>
<span class="sourceLineNo">162</span>                out.append("&lt;/table&gt;");<a name="line.162"></a>
<span class="sourceLineNo">163</span>                if (!correctFormat) return out.toString();<a name="line.163"></a>
<span class="sourceLineNo">164</span><a name="line.164"></a>
<span class="sourceLineNo">165</span>                this.stat = new Statistics(netPlan,netPlan.getNetworkLayerDefault());<a name="line.165"></a>
<span class="sourceLineNo">166</span>                out.append("&lt;h2&gt;&lt;a name=\"generalStats\"&gt;&lt;/a&gt;GENERAL STATISTICS - Signal metrics at the input of end OADM&lt;/h2&gt;");<a name="line.166"></a>
<span class="sourceLineNo">167</span>                out.append("&lt;table border='1'&gt;");<a name="line.167"></a>
<span class="sourceLineNo">168</span>                out.append("&lt;tr&gt;&lt;th align=\"left\"&gt;&lt;b&gt;OADM stats&lt;/b&gt;&lt;/th&gt;&lt;/tr&gt;");<a name="line.168"></a>
<span class="sourceLineNo">169</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Number of OADMs&lt;/td&gt;&lt;td&gt;" + netPlan.getNumberOfNodes() + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.169"></a>
<span class="sourceLineNo">170</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Node in degree (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.nodeInDegree.toString(df_2) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.170"></a>
<span class="sourceLineNo">171</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Node out degree (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.nodeOutDegree.toString(df_2) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.171"></a>
<span class="sourceLineNo">172</span>                <a name="line.172"></a>
<span class="sourceLineNo">173</span>                out.append("&lt;tr&gt;&lt;th align=\"left\"&gt;&lt;b&gt;Fiber link stats&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;");<a name="line.173"></a>
<span class="sourceLineNo">174</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Number of fibers&lt;/td&gt;&lt;td&gt;" + netPlan.getNumberOfLinks() + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.174"></a>
<span class="sourceLineNo">175</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Number of frequency slots per fiber (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.numberFrequencySlotsPerLink + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.175"></a>
<span class="sourceLineNo">176</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Number of slots occupied per fiber (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.linkUtilizationIncludingProtSegments.toString(df_2) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.176"></a>
<span class="sourceLineNo">177</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;The topology of fibers is bidirectional (in fibers and number of slots)?&lt;/td&gt;&lt;td&gt;" + stat.bidirectionalLinks + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.177"></a>
<span class="sourceLineNo">178</span>                <a name="line.178"></a>
<span class="sourceLineNo">179</span>                out.append("&lt;tr&gt;&lt;th align=\"left\"&gt;&lt;b&gt;Traffic stats&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;");<a name="line.179"></a>
<span class="sourceLineNo">180</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Number of demands&lt;/td&gt;&lt;td&gt;" + netPlan.getNumberOfDemands() + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.180"></a>
<span class="sourceLineNo">181</span>                final double offeredTraffic = netPlan.getVectorDemandOfferedTraffic().zSum();<a name="line.181"></a>
<span class="sourceLineNo">182</span>                final double blockedTraffic = netPlan.getVectorDemandBlockedTraffic().zSum();<a name="line.182"></a>
<span class="sourceLineNo">183</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Total offered traffic&lt;/td&gt;&lt;td&gt;" + df_2.format(offeredTraffic) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.183"></a>
<span class="sourceLineNo">184</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Total blocked traffic&lt;/td&gt;&lt;td&gt;" + df_2.format(blockedTraffic) + "(block prob: " + df_2.format(offeredTraffic == 0? 0 : blockedTraffic / offeredTraffic) + ")" + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.184"></a>
<span class="sourceLineNo">185</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;The offered traffic is symmetric?&lt;/td&gt;&lt;td&gt;" + stat.bidirectionalDemands + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.185"></a>
<span class="sourceLineNo">186</span><a name="line.186"></a>
<span class="sourceLineNo">187</span>                out.append("&lt;tr&gt;&lt;th align=\"left\"&gt;&lt;b&gt;Lightpath stats&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;");<a name="line.187"></a>
<span class="sourceLineNo">188</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Number of lightpaths (route objects)&lt;/td&gt;&lt;td&gt;" + netPlan.getNumberOfRoutes() + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.188"></a>
<span class="sourceLineNo">189</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;The lightpaths are bidirectional? (same number of the same line rate between each node pair)?&lt;/td&gt;&lt;td&gt;" + stat.bidirectionalRoutes + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.189"></a>
<span class="sourceLineNo">190</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Some demands are carried by more than one lightpath?&lt;/td&gt;&lt;td&gt;" + stat.unicastRoutingBifurcated + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.190"></a>
<span class="sourceLineNo">191</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Lightpath length in km (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.lpLengthKm.toString(df_2) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.191"></a>
<span class="sourceLineNo">192</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Lightpath length in num hops (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.lpLengthHops.toString(df_2) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.192"></a>
<span class="sourceLineNo">193</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Lightpath propagation delay in ms (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.lpLengthMs.toString(df_2) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.193"></a>
<span class="sourceLineNo">194</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Total number of signal regenerators placed&lt;/td&gt;&lt;td&gt;" + stat.numberOfSignalRegenerators + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.194"></a>
<span class="sourceLineNo">195</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Total number of frequency slot converters needed&lt;/td&gt;&lt;td&gt;" + stat.numberOfWavelengthConversions + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.195"></a>
<span class="sourceLineNo">196</span>                <a name="line.196"></a>
<span class="sourceLineNo">197</span>                out.append("&lt;tr&gt;&lt;th align=\"left\"&gt;&lt;b&gt;Resilience stats&lt;/b&gt;&lt;/th&gt;&lt;/tr&gt;");<a name="line.197"></a>
<span class="sourceLineNo">198</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Number of reserved protection segments&lt;/td&gt;&lt;td&gt;" + netPlan.getNumberOfProtectionSegments() + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.198"></a>
<span class="sourceLineNo">199</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;The protection lightpaths are bidirectional? (same number of the same number of slots reserved between each node pair)?&lt;/td&gt;&lt;td&gt;" + stat.bidirectionalProtectionSegments + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.199"></a>
<span class="sourceLineNo">200</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;Fiber capacity (number of slots) reserved for protection (min/average/max)&lt;/td&gt;&lt;td&gt;" + stat.fiberCapacityReservedForProtection.toString(df_2) + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.200"></a>
<span class="sourceLineNo">201</span>                final Triple&lt;Double, Double, Double&gt; resilienceInfo = TrafficComputationEngine.getTrafficProtectionDegree(netPlan);<a name="line.201"></a>
<span class="sourceLineNo">202</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;% of carried traffic unprotected&lt;/td&gt;&lt;td&gt;" + df_2.format(resilienceInfo.getFirst()) + " %" + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.202"></a>
<span class="sourceLineNo">203</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;% of carried traffic with complete and dedicated protection (e.g. 1+1)&lt;/td&gt;&lt;td&gt;" + df_2.format(resilienceInfo.getSecond()) + " %" + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.203"></a>
<span class="sourceLineNo">204</span>                out.append("&lt;tr&gt;&lt;td align=\"left\"&gt;% of carried traffic with partial and/or shared protection&lt;/td&gt;&lt;td&gt;" + df_2.format(resilienceInfo.getThird()) + " %" + "&lt;/td&gt;&lt;/tr&gt;");<a name="line.204"></a>
<span class="sourceLineNo">205</span>                out.append("&lt;/table&gt;");<a name="line.205"></a>
<span class="sourceLineNo">206</span>                <a name="line.206"></a>
<span class="sourceLineNo">207</span>                /* Per link information */<a name="line.207"></a>
<span class="sourceLineNo">208</span>                out.append("&lt;h2&gt;&lt;a name=\"linkStats\"&gt;&lt;/a&gt;PER FIBER INFORMATION SUMMARY&lt;/h2&gt;");<a name="line.208"></a>
<span class="sourceLineNo">209</span>                out.append("&lt;p&gt;This table shows information for each fiber. In particular, the slots occupied, with a link to the lightpaths occupying it, either for regular lightpaths (L), or lightpaths defined as protection segments (P) that reserve slots:&lt;/p&gt;");<a name="line.209"></a>
<span class="sourceLineNo">210</span>                out.append("&lt;ul&gt;");<a name="line.210"></a>
<span class="sourceLineNo">211</span>                out.append("&lt;li&gt;Black: The slot number is higher than the capacity declared for the link, and is not assigned to any lightpath.&lt;/li&gt;");<a name="line.211"></a>
<span class="sourceLineNo">212</span>                out.append("&lt;li&gt;White: The slot is within the fiber capacity, and is not assigned to any lightpath.&lt;/li&gt;");<a name="line.212"></a>
<span class="sourceLineNo">213</span>                out.append("&lt;li&gt;Green: The slot is within the fiber capacity, and is occupied by one regular lightpath and assigned to no protection lightpath.&lt;/li&gt;");<a name="line.213"></a>
<span class="sourceLineNo">214</span>                out.append("&lt;li&gt;Yellow: The slot is within the fiber capacity, and is occupied by zero regular lightpaths and assigned to one protection lightpath.&lt;/li&gt;");<a name="line.214"></a>
<span class="sourceLineNo">215</span>                out.append("&lt;li&gt;Red: The slot is within the fiber capacity, and is occupied by more than one lightpath (summing regular and protection), or is outside the link capacity and is assigned to at leastone lightpath.&lt;/li&gt;");<a name="line.215"></a>
<span class="sourceLineNo">216</span>                out.append("&lt;/ul&gt;");<a name="line.216"></a>
<span class="sourceLineNo">217</span>                out.append("&lt;table border='1'&gt;");<a name="line.217"></a>
<span class="sourceLineNo">218</span>                out.append("&lt;tr&gt;&lt;th&gt;&lt;b&gt;Fiber #&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Origin node&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Dest. node&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;% slots used&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Ok?&lt;/b&gt;&lt;/th&gt;");<a name="line.218"></a>
<span class="sourceLineNo">219</span>                for (int s = 0; s &lt; stat.maxNumberSlots ; s ++) out.append("&lt;th&gt;" + s + "&lt;/th&gt;");<a name="line.219"></a>
<span class="sourceLineNo">220</span>                out.append("&lt;/tr&gt;");<a name="line.220"></a>
<span class="sourceLineNo">221</span>                <a name="line.221"></a>
<span class="sourceLineNo">222</span>                for (Link e : netPlan.getLinks())<a name="line.222"></a>
<span class="sourceLineNo">223</span>                {<a name="line.223"></a>
<span class="sourceLineNo">224</span>                        final int numSlotsThisFiber = WDMUtils.getFiberNumFrequencySlots(e);<a name="line.224"></a>
<span class="sourceLineNo">225</span>                        out.append("&lt;tr&gt;");<a name="line.225"></a>
<span class="sourceLineNo">226</span>                        out.append("&lt;td&gt;&lt;a name=\"fiber" + e.getIndex() + "\"&gt;" + e.getIndex() + " (id: " + e.getId() + ")"+ "&lt;/a&gt;&lt;/td&gt;");<a name="line.226"></a>
<span class="sourceLineNo">227</span>                        out.append("&lt;td&gt;" + printNode (e.getOriginNode()) + "&lt;/td&gt;");<a name="line.227"></a>
<span class="sourceLineNo">228</span>                        out.append("&lt;td&gt;" + printNode (e.getDestinationNode()) + "&lt;/td&gt;");<a name="line.228"></a>
<span class="sourceLineNo">229</span>                        int numSlotsUsedThisFiber = 0; <a name="line.229"></a>
<span class="sourceLineNo">230</span>                        boolean everythingOk = true;<a name="line.230"></a>
<span class="sourceLineNo">231</span>                        StringBuffer thisLine = new StringBuffer ();<a name="line.231"></a>
<span class="sourceLineNo">232</span>                        for (int s = 0; s &lt; stat.maxNumberSlots ; s ++)<a name="line.232"></a>
<span class="sourceLineNo">233</span>                        {<a name="line.233"></a>
<span class="sourceLineNo">234</span>                                Pair&lt;List&lt;Route&gt; , List&lt;ProtectionSegment&gt;&gt; lists = stat.slotOccupInfo.get(Pair.of(e,s)); <a name="line.234"></a>
<span class="sourceLineNo">235</span>                                List&lt;Route&gt; lps = lists == null? null : lists.getFirst();<a name="line.235"></a>
<span class="sourceLineNo">236</span>                                List&lt;ProtectionSegment&gt; lpProts = lists == null? null : lists.getSecond();<a name="line.236"></a>
<span class="sourceLineNo">237</span>                                String color = "";<a name="line.237"></a>
<span class="sourceLineNo">238</span>                                final boolean inFiberCapacity = (s &lt; numSlotsThisFiber); <a name="line.238"></a>
<span class="sourceLineNo">239</span>                                final int numLps = lps == null? 0 : lps.size();<a name="line.239"></a>
<span class="sourceLineNo">240</span>                                final int numProts = lpProts == null? 0 : lpProts.size();<a name="line.240"></a>
<span class="sourceLineNo">241</span>                                numSlotsUsedThisFiber += numLps + numProts &gt; 0? 1 : 0;<a name="line.241"></a>
<span class="sourceLineNo">242</span>                                if (!inFiberCapacity &amp;&amp; (numLps + numProts == 0)) color = "black";<a name="line.242"></a>
<span class="sourceLineNo">243</span>                                else if (!inFiberCapacity &amp;&amp; (numLps + numProts &gt; 0)) { color = "red"; everythingOk = false; }<a name="line.243"></a>
<span class="sourceLineNo">244</span>                                else if (inFiberCapacity &amp;&amp; (numLps + numProts == 0)) color = "white";<a name="line.244"></a>
<span class="sourceLineNo">245</span>                                else if (inFiberCapacity &amp;&amp; (numLps == 1) &amp;&amp; (numProts == 0)) color = "PaleGreen";<a name="line.245"></a>
<span class="sourceLineNo">246</span>                                else if (inFiberCapacity &amp;&amp; (numLps == 0) &amp;&amp; (numProts == 1)) color = "yellow";<a name="line.246"></a>
<span class="sourceLineNo">247</span>                                else { color = "red"; everythingOk = false; }<a name="line.247"></a>
<span class="sourceLineNo">248</span>                                thisLine.append("&lt;td bgcolor=\"" + color + "\"&gt;");<a name="line.248"></a>
<span class="sourceLineNo">249</span>                                if (lps != null) for (Route r : lps) thisLine.append("&lt;a href=\"#lp" + r.getIndex() + "\"&gt;L" + r.getIndex() + " &lt;/a&gt;");<a name="line.249"></a>
<span class="sourceLineNo">250</span>                                if (lpProts != null) for (ProtectionSegment segment : lpProts) thisLine.append("&lt;a href=\"#lpProt" + segment.getIndex() + "\"&gt;P" + segment.getIndex() + " &lt;/a&gt;");<a name="line.250"></a>
<span class="sourceLineNo">251</span>                                thisLine.append("&lt;/td&gt;");<a name="line.251"></a>
<span class="sourceLineNo">252</span>                        }<a name="line.252"></a>
<span class="sourceLineNo">253</span>                        out.append("&lt;td&gt;" + ((double) numSlotsUsedThisFiber) / ((double) numSlotsThisFiber) + "&lt;/td&gt;");<a name="line.253"></a>
<span class="sourceLineNo">254</span>                        out.append("&lt;td bfcolor=\"" + (everythingOk? "PaleGreen" : "red")   +"\"&gt;" + (everythingOk? "Yes" : "No") +  "&lt;/td&gt;");<a name="line.254"></a>
<span class="sourceLineNo">255</span>                        out.append(thisLine.toString());<a name="line.255"></a>
<span class="sourceLineNo">256</span>                        out.append("&lt;/tr&gt;");<a name="line.256"></a>
<span class="sourceLineNo">257</span>                }<a name="line.257"></a>
<span class="sourceLineNo">258</span>                out.append("&lt;/table&gt;");<a name="line.258"></a>
<span class="sourceLineNo">259</span><a name="line.259"></a>
<span class="sourceLineNo">260</span>                /* Per Route lightpath information */<a name="line.260"></a>
<span class="sourceLineNo">261</span>                out.append("&lt;h2&gt;&lt;a name=\"routeStats\"&gt;&lt;/a&gt;PER LIGHTPATH INFORMATION SUMMARY&lt;/h2&gt;");<a name="line.261"></a>
<span class="sourceLineNo">262</span>                out.append("&lt;p&gt;This table shows information for each regular lightpath: lightpaths defined as Route objects in the design (in opposition to lightpaths defined as ProtectionSegments that reserve a slots in the links).&lt;/p&gt;");<a name="line.262"></a>
<span class="sourceLineNo">263</span>                out.append("&lt;table border='1'&gt;");<a name="line.263"></a>
<span class="sourceLineNo">264</span>                out.append("&lt;tr&gt;&lt;th&gt;&lt;b&gt;Lighpath Route #&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Demand #&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Origin node&lt;/b&gt;&lt;/th&gt;"<a name="line.264"></a>
<span class="sourceLineNo">265</span>                                + "&lt;th&gt;&lt;b&gt;Dest. node&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Trav. nodes&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Length (km)&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Propagation delay (ms)&lt;/b&gt;&lt;/th&gt;"<a name="line.265"></a>
<span class="sourceLineNo">266</span>                                + "&lt;th&gt;&lt;b&gt;Line rate (Gbps)&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Num. slots&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Occupied slots&lt;/b&gt;&lt;/th&gt;"<a name="line.266"></a>
<span class="sourceLineNo">267</span>                                + "&lt;th&gt;&lt;b&gt;Wavelength conversion?&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Wavelength contiguity?&lt;/b&gt;&lt;/th&gt;&lt;/th&gt;"<a name="line.267"></a>
<span class="sourceLineNo">268</span>                                + "&lt;th&gt;&lt;b&gt;Num. regenerators (reg. nodes)&lt;/b&gt;&lt;/th&gt;&lt;b&gt;Protection segments assigned&lt;/b&gt;&lt;/th&gt;&lt;/tr&gt;&lt;th&gt;&lt;b&gt;Ok?&lt;/b&gt;&lt;/th&gt;&lt;/tr&gt;");<a name="line.268"></a>
<span class="sourceLineNo">269</span>                for (Route r : netPlan.getRoutes())<a name="line.269"></a>
<span class="sourceLineNo">270</span>                {<a name="line.270"></a>
<span class="sourceLineNo">271</span>                        WDMUtils.RSA rsa = new WDMUtils.RSA(r , false);<a name="line.271"></a>
<span class="sourceLineNo">272</span>                        out.append("&lt;tr&gt;");<a name="line.272"></a>
<span class="sourceLineNo">273</span>                        out.append("&lt;td&gt;&lt;a name=\"lp" + r.getIndex() + "\"&gt;" + r.getIndex() + " (id: " + r.getId() + ")"+ "&lt;/a&gt;&lt;/td&gt;");<a name="line.273"></a>
<span class="sourceLineNo">274</span>                        out.append("&lt;td&gt;" + r.getDemand().getIndex() + "&lt;/td&gt;");<a name="line.274"></a>
<span class="sourceLineNo">275</span>                        out.append("&lt;td&gt;" + printNode(r.getIngressNode())+ "&lt;/td&gt;");<a name="line.275"></a>
<span class="sourceLineNo">276</span>                        out.append("&lt;td&gt;" + printNode(r.getEgressNode())+ "&lt;/td&gt;");<a name="line.276"></a>
<span class="sourceLineNo">277</span>                        out.append("&lt;td&gt;" + seqNodesString(r.getSeqLinksRealPath()) + "&lt;/td&gt;");<a name="line.277"></a>
<span class="sourceLineNo">278</span>                        out.append("&lt;td&gt;" + df_2.format(r.getLengthInKm()) + "&lt;/td&gt;");<a name="line.278"></a>
<span class="sourceLineNo">279</span>                        out.append("&lt;td&gt;" + df_2.format(r.getPropagationDelayInMiliseconds()) + "&lt;/td&gt;");<a name="line.279"></a>
<span class="sourceLineNo">280</span>                        out.append("&lt;td&gt;" + df_2.format(r.getCarriedTraffic()) + "&lt;/td&gt;");<a name="line.280"></a>
<span class="sourceLineNo">281</span>                        out.append("&lt;td&gt;" + rsa.getNumSlots() + "&lt;/td&gt;");<a name="line.281"></a>
<span class="sourceLineNo">282</span>                        out.append("&lt;td&gt;" + occupiedSlotsString(rsa) + "&lt;/td&gt;");<a name="line.282"></a>
<span class="sourceLineNo">283</span>                        out.append("&lt;td&gt;" + rsa.hasFrequencySlotConversions() + "&lt;/td&gt;");<a name="line.283"></a>
<span class="sourceLineNo">284</span>                        out.append("&lt;td&gt;" + rsa.isFrequencySlotContiguous () + "&lt;/td&gt;");<a name="line.284"></a>
<span class="sourceLineNo">285</span>                        List&lt;Node&gt; regPoints = rsa.getSignalRegenerationNodes (); <a name="line.285"></a>
<span class="sourceLineNo">286</span>                        String regNodesString = ""; for (Node n : regPoints) regNodesString += "(n" + n.getIndex() + ", " + n.getName() + ") ";<a name="line.286"></a>
<span class="sourceLineNo">287</span>                        out.append("&lt;td&gt;" + regPoints.size() + (regPoints.isEmpty()? "" : "[ " + regNodesString + "]"));<a name="line.287"></a>
<span class="sourceLineNo">288</span>                        out.append("&lt;/td&gt;");<a name="line.288"></a>
<span class="sourceLineNo">289</span>                        out.append("&lt;td&gt;");<a name="line.289"></a>
<span class="sourceLineNo">290</span>                        for (ProtectionSegment segment : r.getPotentialBackupProtectionSegments())<a name="line.290"></a>
<span class="sourceLineNo">291</span>                                out.append("&lt;a href=\"#lpProt" + segment.getIndex() + "\"&gt;P" + segment.getIndex() + "&lt;/a&gt; ");<a name="line.291"></a>
<span class="sourceLineNo">292</span>                        out.append("&lt;/td&gt;");<a name="line.292"></a>
<span class="sourceLineNo">293</span>                        boolean isOk = isOk(rsa);<a name="line.293"></a>
<span class="sourceLineNo">294</span>                        out.append("&lt;td bgcolor=\""  +  (isOk? "PaleGreen" : "red") +"\"&gt;" + (isOk? "Yes" : "No") + "&lt;/td&gt;");<a name="line.294"></a>
<span class="sourceLineNo">295</span>                        out.append("&lt;/tr&gt;");<a name="line.295"></a>
<span class="sourceLineNo">296</span>                }<a name="line.296"></a>
<span class="sourceLineNo">297</span>                out.append("&lt;/table&gt;");<a name="line.297"></a>
<span class="sourceLineNo">298</span><a name="line.298"></a>
<span class="sourceLineNo">299</span>                /* Per protection lightpath information */<a name="line.299"></a>
<span class="sourceLineNo">300</span>                out.append("&lt;h2&gt;&lt;a name=\"protectionStats\"&gt;&lt;/a&gt;PER PROTECTION LIGHTPATH INFORMATION SUMMARY&lt;/h2&gt;");<a name="line.300"></a>
<span class="sourceLineNo">301</span>                out.append("&lt;p&gt;This table shows information for each so-called protection lightpath: lightpaths defined as ProtectionSegment objects in the design that reserve slots in the links.&lt;/p&gt;");<a name="line.301"></a>
<span class="sourceLineNo">302</span>                out.append("&lt;table border='1'&gt;");<a name="line.302"></a>
<span class="sourceLineNo">303</span>                out.append("&lt;tr&gt;&lt;th&gt;&lt;b&gt;Lighpath ProtectionSegment #&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Primary routes #&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Origin node&lt;/b&gt;&lt;/th&gt;"<a name="line.303"></a>
<span class="sourceLineNo">304</span>                                + "&lt;th&gt;&lt;b&gt;Dest. node&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Trav. nodes&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Length (km)&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Propagation delay (ms)&lt;/b&gt;&lt;/th&gt;"<a name="line.304"></a>
<span class="sourceLineNo">305</span>                                + "&lt;th&gt;&lt;b&gt;Num. slots&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Occupied slots&lt;/b&gt;&lt;/th&gt;"<a name="line.305"></a>
<span class="sourceLineNo">306</span>                                + "&lt;th&gt;&lt;b&gt;Wavelength conversion?&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Wavelength contiguity?&lt;/b&gt;&lt;/th&gt;&lt;/th&gt;"<a name="line.306"></a>
<span class="sourceLineNo">307</span>                                + "&lt;th&gt;&lt;b&gt;Num. regenerators (reg. nodes)&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Ok?&lt;/b&gt;&lt;/th&gt;&lt;/tr&gt;");<a name="line.307"></a>
<span class="sourceLineNo">308</span>                for (ProtectionSegment segment : netPlan.getProtectionSegments ())<a name="line.308"></a>
<span class="sourceLineNo">309</span>                {<a name="line.309"></a>
<span class="sourceLineNo">310</span>                        WDMUtils.RSA rsa = new WDMUtils.RSA(segment);<a name="line.310"></a>
<span class="sourceLineNo">311</span>                        out.append("&lt;tr&gt;");<a name="line.311"></a>
<span class="sourceLineNo">312</span>                        out.append("&lt;td&gt;&lt;a name=\"lpProt" + segment.getIndex() + "\"&gt;" + segment.getIndex() + " (id: " + segment.getId() + ")"+ "&lt;/a&gt;&lt;/td&gt;");<a name="line.312"></a>
<span class="sourceLineNo">313</span>                        out.append("&lt;td&gt;");<a name="line.313"></a>
<span class="sourceLineNo">314</span>                        for (Route r : segment.getAssociatedRoutesToWhichIsBackup())<a name="line.314"></a>
<span class="sourceLineNo">315</span>                                out.append("&lt;a href=\"#lp" + r.getIndex() + "\"&gt;L" + r.getIndex() + "&lt;/a&gt; ");<a name="line.315"></a>
<span class="sourceLineNo">316</span>                        out.append("&lt;/td&gt;");<a name="line.316"></a>
<span class="sourceLineNo">317</span>                        out.append("&lt;td&gt;" + printNode(segment.getOriginNode()) + "&lt;/td&gt;");<a name="line.317"></a>
<span class="sourceLineNo">318</span>                        out.append("&lt;td&gt;" + printNode(segment.getDestinationNode()) + "&lt;/td&gt;");<a name="line.318"></a>
<span class="sourceLineNo">319</span>                        out.append("&lt;td&gt;" + seqNodesString(segment.getSeqLinks()) + "&lt;/td&gt;");<a name="line.319"></a>
<span class="sourceLineNo">320</span>                        out.append("&lt;td&gt;" + df_2.format(segment.getLengthInKm()) + "&lt;/td&gt;");<a name="line.320"></a>
<span class="sourceLineNo">321</span>                        out.append("&lt;td&gt;" + df_2.format(segment.getPropagationDelayInMs()) + "&lt;/td&gt;");<a name="line.321"></a>
<span class="sourceLineNo">322</span>                        out.append("&lt;td&gt;" + rsa.getNumSlots() + "&lt;/td&gt;");<a name="line.322"></a>
<span class="sourceLineNo">323</span>                        out.append("&lt;td&gt;" + occupiedSlotsString(rsa) + "&lt;/td&gt;");<a name="line.323"></a>
<span class="sourceLineNo">324</span>                        out.append("&lt;td&gt;" + rsa.hasFrequencySlotConversions() + "&lt;/td&gt;");<a name="line.324"></a>
<span class="sourceLineNo">325</span>                        out.append("&lt;td&gt;" + rsa.isFrequencySlotContiguous () + "&lt;/td&gt;");<a name="line.325"></a>
<span class="sourceLineNo">326</span>                        List&lt;Node&gt; regPoints = rsa.getSignalRegenerationNodes (); <a name="line.326"></a>
<span class="sourceLineNo">327</span>                        <a name="line.327"></a>
<span class="sourceLineNo">328</span>                        out.append("&lt;td&gt;" + regPoints.size() + (regPoints.isEmpty()? "" : "(" + regPoints + ")"));<a name="line.328"></a>
<span class="sourceLineNo">329</span>                        out.append("&lt;/td&gt;");<a name="line.329"></a>
<span class="sourceLineNo">330</span>                        boolean isOk = isOk(rsa);<a name="line.330"></a>
<span class="sourceLineNo">331</span>                        out.append("&lt;td bgcolor=\""  +  (isOk? "PaleGreen" : "red") +"\"&gt;" + (isOk? "Yes" : "No") + "&lt;/td&gt;");<a name="line.331"></a>
<span class="sourceLineNo">332</span>                        out.append("&lt;/tr&gt;");<a name="line.332"></a>
<span class="sourceLineNo">333</span>                }<a name="line.333"></a>
<span class="sourceLineNo">334</span>                out.append("&lt;/table&gt;");<a name="line.334"></a>
<span class="sourceLineNo">335</span><a name="line.335"></a>
<span class="sourceLineNo">336</span>                <a name="line.336"></a>
<span class="sourceLineNo">337</span>                /* Per OADM information */<a name="line.337"></a>
<span class="sourceLineNo">338</span>                out.append("&lt;h2&gt;&lt;a name=\"nodeStats\"&gt;&lt;/a&gt;PER OADM NODE INFORMATION SUMMARY&lt;/h2&gt;");<a name="line.338"></a>
<span class="sourceLineNo">339</span>                out.append("&lt;p&gt;This table shows information for each Optical Add/Drop Multiplexer (OADM) node in the network.&lt;/p&gt;");<a name="line.339"></a>
<span class="sourceLineNo">340</span>                out.append("&lt;table border='1'&gt;");<a name="line.340"></a>
<span class="sourceLineNo">341</span>                out.append("&lt;tr&gt;&lt;th&gt;&lt;b&gt;OADM # and name&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Num. input fibers&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Num. output fibers&lt;/b&gt;&lt;/th&gt;"<a name="line.341"></a>
<span class="sourceLineNo">342</span>                                + "&lt;th&gt;&lt;b&gt;Num. add lps total (reg/prot)&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Num. drop lps total (reg/prot)&lt;/b&gt;&lt;/th&gt;&lt;th&gt;&lt;b&gt;Num. express lps total (reg/prto)&lt;/b&gt;&lt;/th&gt;"<a name="line.342"></a>
<span class="sourceLineNo">343</span>                                + "&lt;th&gt;&lt;b&gt;Num. signal regenerators total (reg/prot)&lt;/b&gt;&lt;/th&gt;"<a name="line.343"></a>
<span class="sourceLineNo">344</span>                                + "&lt;th&gt;&lt;b&gt;Num. slot conversions total (reg/prot)&lt;/b&gt;&lt;/th&gt;&lt;/tr&gt;");<a name="line.344"></a>
<span class="sourceLineNo">345</span>                for (Node n : netPlan.getNodes())<a name="line.345"></a>
<span class="sourceLineNo">346</span>                {<a name="line.346"></a>
<span class="sourceLineNo">347</span>                        final int addRegLps = n.getOutgoingRoutes().size();<a name="line.347"></a>
<span class="sourceLineNo">348</span>                        final int dropRegLps = n.getIncomingRoutes().size();<a name="line.348"></a>
<span class="sourceLineNo">349</span>                        final int expressRegLps = n.getAssociatedRoutes().size() - addRegLps - dropRegLps;<a name="line.349"></a>
<span class="sourceLineNo">350</span>                        int addProtLps = 0; int dropProtLps = 0; int expressProtLps = 0;<a name="line.350"></a>
<span class="sourceLineNo">351</span>                        for (ProtectionSegment s : n.getAssociatedProtectionSegments())<a name="line.351"></a>
<span class="sourceLineNo">352</span>                                if (s.getOriginNode() == n) addProtLps ++; else if (s.getDestinationNode() == n) dropProtLps ++; else expressProtLps ++;<a name="line.352"></a>
<span class="sourceLineNo">353</span>                        Pair&lt;List&lt;Route&gt;,List&lt;ProtectionSegment&gt;&gt; lists = stat.regOccupInfo.get(n);<a name="line.353"></a>
<span class="sourceLineNo">354</span>                        final int regenRegLp = lists == null? 0 : lists.getFirst().size();<a name="line.354"></a>
<span class="sourceLineNo">355</span>                        final int regenProtLp = lists == null? 0 : lists.getSecond().size();<a name="line.355"></a>
<span class="sourceLineNo">356</span>                        int wcRegLp = 0; for (Route r : n.getAssociatedRoutes()) for (Node nReg : stat.routeLpRSA.get(r.getIndex()).getNodesWithFrequencySlotConversion()) if (n == nReg) wcRegLp ++;<a name="line.356"></a>
<span class="sourceLineNo">357</span>                        int wcProtLp = 0; for (ProtectionSegment r : n.getAssociatedProtectionSegments()) for (Node nReg : stat.protLpRSA.get(r.getIndex()).getNodesWithFrequencySlotConversion()) if (n == nReg) wcProtLp ++;<a name="line.357"></a>
<span class="sourceLineNo">358</span>                        out.append("&lt;tr&gt;");<a name="line.358"></a>
<span class="sourceLineNo">359</span>                        out.append("&lt;td&gt;&lt;a name=\"node" + n.getIndex() + "\"&gt;n" + n.getIndex() + " (" + n.getName() + ")" + "&lt;/a&gt;&lt;/td&gt;");<a name="line.359"></a>
<span class="sourceLineNo">360</span>                        out.append("&lt;td&gt;" + n.getIncomingLinks().size() + "&lt;/td&gt;");<a name="line.360"></a>
<span class="sourceLineNo">361</span>                        out.append("&lt;td&gt;" + n.getOutgoingLinks().size() + "&lt;/td&gt;");<a name="line.361"></a>
<span class="sourceLineNo">362</span>                        out.append("&lt;td&gt;" + (addRegLps+addProtLps) + "(" + addRegLps + " / " + addProtLps + ")" + "&lt;/td&gt;");<a name="line.362"></a>
<span class="sourceLineNo">363</span>                        out.append("&lt;td&gt;" + (dropRegLps+dropProtLps) + "(" + dropRegLps + " / " + dropProtLps + ")" + "&lt;/td&gt;");<a name="line.363"></a>
<span class="sourceLineNo">364</span>                        out.append("&lt;td&gt;" + (expressRegLps+expressProtLps) + "(" + expressRegLps + " / " + expressProtLps + ")" + "&lt;/td&gt;");<a name="line.364"></a>
<span class="sourceLineNo">365</span>                        out.append("&lt;td&gt;" + (regenProtLp+regenRegLp) + "(" + regenRegLp + " / " + regenProtLp + ")" + "&lt;/td&gt;");<a name="line.365"></a>
<span class="sourceLineNo">366</span>                        out.append("&lt;td&gt;" + (wcRegLp+wcProtLp) + "(" + wcRegLp + " / " + wcProtLp + ")" + "&lt;/td&gt;");<a name="line.366"></a>
<span class="sourceLineNo">367</span>                }<a name="line.367"></a>
<span class="sourceLineNo">368</span>                out.append("&lt;/table&gt;");<a name="line.368"></a>
<span class="sourceLineNo">369</span><a name="line.369"></a>
<span class="sourceLineNo">370</span>                <a name="line.370"></a>
<span class="sourceLineNo">371</span>                out.append("&lt;/body&gt;&lt;/html&gt;");<a name="line.371"></a>
<span class="sourceLineNo">372</span>                return out.toString();<a name="line.372"></a>
<span class="sourceLineNo">373</span>        }<a name="line.373"></a>
<span class="sourceLineNo">374</span><a name="line.374"></a>
<span class="sourceLineNo">375</span><a name="line.375"></a>
<span class="sourceLineNo">376</span>        private boolean isOk (WDMUtils.RSA rsa)<a name="line.376"></a>
<span class="sourceLineNo">377</span>        {<a name="line.377"></a>
<span class="sourceLineNo">378</span>                int counterLink = 0;<a name="line.378"></a>
<span class="sourceLineNo">379</span>                for (Link e : rsa.seqLinks)<a name="line.379"></a>
<span class="sourceLineNo">380</span>                {<a name="line.380"></a>
<span class="sourceLineNo">381</span>                        for (int contS = 0; contS &lt; rsa.getNumSlots() ; contS ++)<a name="line.381"></a>
<span class="sourceLineNo">382</span>                        {<a name="line.382"></a>
<span class="sourceLineNo">383</span>                                final int s = rsa.seqFrequencySlots_se.get(contS , counterLink);<a name="line.383"></a>
<span class="sourceLineNo">384</span>                                if (s &gt;= WDMUtils.getFiberNumFrequencySlots(e)) return false;<a name="line.384"></a>
<span class="sourceLineNo">385</span>                                final int numLps = stat.slotOccupInfo.containsKey(Pair.of(e,s))? stat.slotOccupInfo.get(Pair.of(e,s)).getFirst().size() : 0;<a name="line.385"></a>
<span class="sourceLineNo">386</span>                                final int numLpsProt = stat.slotOccupInfo.containsKey(Pair.of(e,s))? stat.slotOccupInfo.get(Pair.of(e,s)).getSecond().size() : 0;<a name="line.386"></a>
<span class="sourceLineNo">387</span>                                if (numLps+numLpsProt &gt; 1) return false;<a name="line.387"></a>
<span class="sourceLineNo">388</span>                        }<a name="line.388"></a>
<span class="sourceLineNo">389</span>                        counterLink ++;<a name="line.389"></a>
<span class="sourceLineNo">390</span>                }<a name="line.390"></a>
<span class="sourceLineNo">391</span>                return true;<a name="line.391"></a>
<span class="sourceLineNo">392</span>        }<a name="line.392"></a>
<span class="sourceLineNo">393</span>        <a name="line.393"></a>
<span class="sourceLineNo">394</span>        private String occupiedSlotsString (WDMUtils.RSA rsa)<a name="line.394"></a>
<span class="sourceLineNo">395</span>        {<a name="line.395"></a>
<span class="sourceLineNo">396</span>                if (!rsa.hasFrequencySlotConversions() &amp;&amp; rsa.isFrequencySlotContiguous ()) return rsa.seqFrequencySlots_se.get(0,0) + "-"  +rsa.seqFrequencySlots_se.get(rsa.getNumSlots()-1,0);<a name="line.396"></a>
<span class="sourceLineNo">397</span>                String res = "";<a name="line.397"></a>
<span class="sourceLineNo">398</span>                for (int e = 0 ; e &lt; rsa.seqFrequencySlots_se.rows() ; e ++)<a name="line.398"></a>
<span class="sourceLineNo">399</span>                {<a name="line.399"></a>
<span class="sourceLineNo">400</span>                        res += "&lt;p&gt;";<a name="line.400"></a>
<span class="sourceLineNo">401</span>                        for (int s = 0 ; s &lt; rsa.getNumSlots() ; s ++) res += rsa.seqFrequencySlots_se.get(e,s) + " ";<a name="line.401"></a>
<span class="sourceLineNo">402</span>                        res += "&lt;/p&gt;";<a name="line.402"></a>
<span class="sourceLineNo">403</span>                }<a name="line.403"></a>
<span class="sourceLineNo">404</span>                return rsa.toString();<a name="line.404"></a>
<span class="sourceLineNo">405</span>        }<a name="line.405"></a>
<span class="sourceLineNo">406</span>        <a name="line.406"></a>
<span class="sourceLineNo">407</span>        private static class Statistics<a name="line.407"></a>
<span class="sourceLineNo">408</span>        {<a name="line.408"></a>
<span class="sourceLineNo">409</span>                private MinMaxAvCollector nodeInDegree = new MinMaxAvCollector ();<a name="line.409"></a>
<span class="sourceLineNo">410</span>                private MinMaxAvCollector nodeOutDegree = new MinMaxAvCollector ();<a name="line.410"></a>
<span class="sourceLineNo">411</span>                private int numberOfSignalRegenerators = 0;<a name="line.411"></a>
<span class="sourceLineNo">412</span>                private int numberOfWavelengthConversions = 0;<a name="line.412"></a>
<span class="sourceLineNo">413</span>                private int maxNumberSlots;<a name="line.413"></a>
<span class="sourceLineNo">414</span>                private boolean bidirectionalLinks;<a name="line.414"></a>
<span class="sourceLineNo">415</span>                private boolean bidirectionalDemands;<a name="line.415"></a>
<span class="sourceLineNo">416</span>                private boolean bidirectionalRoutes;<a name="line.416"></a>
<span class="sourceLineNo">417</span>                private boolean bidirectionalProtectionSegments;<a name="line.417"></a>
<span class="sourceLineNo">418</span>                private MinMaxAvCollector numberFrequencySlotsPerLink = new MinMaxAvCollector ();<a name="line.418"></a>
<span class="sourceLineNo">419</span>                private boolean unicastRoutingBifurcated;<a name="line.419"></a>
<span class="sourceLineNo">420</span>                private MinMaxAvCollector linkUtilizationIncludingProtSegments = new MinMaxAvCollector ();<a name="line.420"></a>
<span class="sourceLineNo">421</span>                private MinMaxAvCollector lpLengthKm = new MinMaxAvCollector ();<a name="line.421"></a>
<span class="sourceLineNo">422</span>                private MinMaxAvCollector lpLengthHops = new MinMaxAvCollector ();<a name="line.422"></a>
<span class="sourceLineNo">423</span>                private MinMaxAvCollector lpLengthMs = new MinMaxAvCollector ();<a name="line.423"></a>
<span class="sourceLineNo">424</span>                private MinMaxAvCollector fiberCapacityReservedForProtection = new MinMaxAvCollector ();<a name="line.424"></a>
<span class="sourceLineNo">425</span>                private Map&lt;Pair&lt;Link,Integer&gt;,Pair&lt;List&lt;Route&gt;,List&lt;ProtectionSegment&gt;&gt;&gt; slotOccupInfo = null;<a name="line.425"></a>
<span class="sourceLineNo">426</span>                private Map&lt;Node,Pair&lt;List&lt;Route&gt;,List&lt;ProtectionSegment&gt;&gt;&gt; regOccupInfo = null;<a name="line.426"></a>
<span class="sourceLineNo">427</span>                private List&lt;WDMUtils.RSA&gt; routeLpRSA = new ArrayList&lt;WDMUtils.RSA&gt; ();<a name="line.427"></a>
<span class="sourceLineNo">428</span>                private List&lt;WDMUtils.RSA&gt; protLpRSA = new ArrayList&lt;WDMUtils.RSA&gt; ();<a name="line.428"></a>
<span class="sourceLineNo">429</span>                <a name="line.429"></a>
<span class="sourceLineNo">430</span>                <a name="line.430"></a>
<span class="sourceLineNo">431</span>                private Statistics (NetPlan netPlan , NetworkLayer wdmLayer) <a name="line.431"></a>
<span class="sourceLineNo">432</span>                { <a name="line.432"></a>
<span class="sourceLineNo">433</span>                        for (Node n : netPlan.getNodes())<a name="line.433"></a>
<span class="sourceLineNo">434</span>                        {<a name="line.434"></a>
<span class="sourceLineNo">435</span>                                nodeInDegree.add(n.getIncomingLinks(wdmLayer).size());<a name="line.435"></a>
<span class="sourceLineNo">436</span>                                nodeOutDegree.add(n.getOutgoingLinks(wdmLayer).size());<a name="line.436"></a>
<span class="sourceLineNo">437</span>                        }<a name="line.437"></a>
<span class="sourceLineNo">438</span>                        bidirectionalLinks = GraphUtils.isWeightedBidirectional(netPlan.getNodes() , netPlan.getLinks() , netPlan.getVectorLinkCapacity());<a name="line.438"></a>
<span class="sourceLineNo">439</span>                        bidirectionalDemands = GraphUtils.isWeightedBidirectional(netPlan.getNodes() , netPlan.getDemands() , netPlan.getVectorDemandOfferedTraffic());<a name="line.439"></a>
<span class="sourceLineNo">440</span>                        bidirectionalRoutes = GraphUtils.isWeightedBidirectional(netPlan.getNodes() , netPlan.getRoutes () , netPlan.getVectorRouteCarriedTraffic());<a name="line.440"></a>
<span class="sourceLineNo">441</span>                        bidirectionalProtectionSegments = GraphUtils.isWeightedBidirectional(netPlan.getNodes() , netPlan.getProtectionSegments() , netPlan.getVectorProtectionSegmentOccupiedCapacity());<a name="line.441"></a>
<span class="sourceLineNo">442</span>                        for (Link e : netPlan.getLinks())<a name="line.442"></a>
<span class="sourceLineNo">443</span>                        {<a name="line.443"></a>
<span class="sourceLineNo">444</span>                                numberFrequencySlotsPerLink.add((double) WDMUtils.getFiberNumFrequencySlots(e));<a name="line.444"></a>
<span class="sourceLineNo">445</span>                                linkUtilizationIncludingProtSegments.add(e.getOccupiedCapacityIncludingProtectionSegments());<a name="line.445"></a>
<span class="sourceLineNo">446</span>                                fiberCapacityReservedForProtection.add(e.getOccupiedCapacityIncludingProtectionSegments() - e.getOccupiedCapacityNotIncludingProtectionSegments());<a name="line.446"></a>
<span class="sourceLineNo">447</span>                        }<a name="line.447"></a>
<span class="sourceLineNo">448</span>                        unicastRoutingBifurcated = false;<a name="line.448"></a>
<span class="sourceLineNo">449</span>                        for (Demand d : netPlan.getDemands())<a name="line.449"></a>
<span class="sourceLineNo">450</span>                                if (d.getRoutes().size() &gt; 1) { unicastRoutingBifurcated = false; break; }<a name="line.450"></a>
<span class="sourceLineNo">451</span>                        for (Route r : netPlan.getRoutes())<a name="line.451"></a>
<span class="sourceLineNo">452</span>                        {<a name="line.452"></a>
<span class="sourceLineNo">453</span>                                lpLengthHops.add(r.getNumberOfHops());<a name="line.453"></a>
<span class="sourceLineNo">454</span>                                lpLengthKm.add(r.getLengthInKm());<a name="line.454"></a>
<span class="sourceLineNo">455</span>                                lpLengthMs.add(r.getPropagationDelayInMiliseconds());<a name="line.455"></a>
<span class="sourceLineNo">456</span>                        }<a name="line.456"></a>
<span class="sourceLineNo">457</span>                        this.maxNumberSlots = (int) WDMUtils.getVectorFiberNumFrequencySlots(netPlan).getMaxLocation() [0];<a name="line.457"></a>
<span class="sourceLineNo">458</span>                        Pair&lt;Map&lt;Pair&lt;Link,Integer&gt;,Pair&lt;List&lt;Route&gt;,List&lt;ProtectionSegment&gt;&gt;&gt; , Map&lt;Node,Pair&lt;List&lt;Route&gt;,List&lt;ProtectionSegment&gt;&gt;&gt;&gt; pair = WDMUtils.getNetworkSlotOccupancyMap(netPlan , false);<a name="line.458"></a>
<span class="sourceLineNo">459</span>                        this.slotOccupInfo = pair.getFirst();<a name="line.459"></a>
<span class="sourceLineNo">460</span>                        this.regOccupInfo = pair.getSecond();<a name="line.460"></a>
<span class="sourceLineNo">461</span>                        for (Node n : netPlan.getNodes())<a name="line.461"></a>
<span class="sourceLineNo">462</span>                        {<a name="line.462"></a>
<span class="sourceLineNo">463</span>                                Pair&lt;List&lt;Route&gt;,List&lt;ProtectionSegment&gt;&gt; lists = regOccupInfo.get(n); <a name="line.463"></a>
<span class="sourceLineNo">464</span>                                numberOfSignalRegenerators += (lists == null? 0 : lists.getFirst().size() + lists.getSecond().size());<a name="line.464"></a>
<span class="sourceLineNo">465</span>                        }       <a name="line.465"></a>
<span class="sourceLineNo">466</span>                                        <a name="line.466"></a>
<span class="sourceLineNo">467</span>                        for (Route lp : netPlan.getRoutes())<a name="line.467"></a>
<span class="sourceLineNo">468</span>                        {<a name="line.468"></a>
<span class="sourceLineNo">469</span>                                WDMUtils.RSA rsa = new WDMUtils.RSA(lp , false);<a name="line.469"></a>
<span class="sourceLineNo">470</span>                                numberOfWavelengthConversions += rsa.getNodesWithFrequencySlotConversion().size();<a name="line.470"></a>
<span class="sourceLineNo">471</span>                                routeLpRSA.add(rsa);<a name="line.471"></a>
<span class="sourceLineNo">472</span>                        }<a name="line.472"></a>
<span class="sourceLineNo">473</span>                        for (ProtectionSegment lp : netPlan.getProtectionSegments())<a name="line.473"></a>
<span class="sourceLineNo">474</span>                        {<a name="line.474"></a>
<span class="sourceLineNo">475</span>                                WDMUtils.RSA rsa = new WDMUtils.RSA(lp);<a name="line.475"></a>
<span class="sourceLineNo">476</span>                                numberOfWavelengthConversions += rsa.getNodesWithFrequencySlotConversion().size();<a name="line.476"></a>
<span class="sourceLineNo">477</span>                                protLpRSA.add(rsa);<a name="line.477"></a>
<span class="sourceLineNo">478</span>                        }<a name="line.478"></a>
<span class="sourceLineNo">479</span>                }<a name="line.479"></a>
<span class="sourceLineNo">480</span>                <a name="line.480"></a>
<span class="sourceLineNo">481</span>        }<a name="line.481"></a>
<span class="sourceLineNo">482</span><a name="line.482"></a>
<span class="sourceLineNo">483</span>        private String seqNodesString(List&lt;Link&gt; seqLinks)<a name="line.483"></a>
<span class="sourceLineNo">484</span>        {<a name="line.484"></a>
<span class="sourceLineNo">485</span>                if (seqLinks.isEmpty()) return "";<a name="line.485"></a>
<span class="sourceLineNo">486</span>                String st = "[ " + printNode(seqLinks.get(0).getOriginNode());<a name="line.486"></a>
<span class="sourceLineNo">487</span>                for (Link e : seqLinks)<a name="line.487"></a>
<span class="sourceLineNo">488</span>                        st += " -&gt; " + printNode(e.getDestinationNode());<a name="line.488"></a>
<span class="sourceLineNo">489</span>                return st + " ]";<a name="line.489"></a>
<span class="sourceLineNo">490</span>        }<a name="line.490"></a>
<span class="sourceLineNo">491</span><a name="line.491"></a>
<span class="sourceLineNo">492</span>        private String printNode (Node n) { return "&lt;a href=\"#node" + n.getIndex() + "\"&gt;n" + n.getIndex() + " (" + n.getName() + ")&lt;/a&gt;"; }<a name="line.492"></a>
<span class="sourceLineNo">493</span>        <a name="line.493"></a>
<span class="sourceLineNo">494</span>        private static class MinMaxAvCollector<a name="line.494"></a>
<span class="sourceLineNo">495</span>        {<a name="line.495"></a>
<span class="sourceLineNo">496</span>                private double min, max, accum;<a name="line.496"></a>
<span class="sourceLineNo">497</span>                private int numSamples;<a name="line.497"></a>
<span class="sourceLineNo">498</span>                MinMaxAvCollector () { min = 0; max = 0; accum = 0; numSamples = 0; }<a name="line.498"></a>
<span class="sourceLineNo">499</span>                void add (double sample) { min = numSamples == 0? sample : Math.min(min,sample); max = numSamples == 0? sample : Math.max(max,sample); accum += sample; numSamples ++; }<a name="line.499"></a>
<span class="sourceLineNo">500</span>                double getAv () { return numSamples == 0? 0 : accum/numSamples;  }<a name="line.500"></a>
<span class="sourceLineNo">501</span>                public String toString () { return min + " / " + getAv() + " / " + max; } <a name="line.501"></a>
<span class="sourceLineNo">502</span>                public String toString (DecimalFormat df) { return df.format(min) + " / " + df.format(getAv()) + " / " + df.format(max); } <a name="line.502"></a>
<span class="sourceLineNo">503</span>        }<a name="line.503"></a>
<span class="sourceLineNo">504</span>}<a name="line.504"></a>




























































</pre>
</div>
</body>
</html>
